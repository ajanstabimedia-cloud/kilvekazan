<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mehmet Ya≈üar Kandemir ƒ∞HO Namaz & Ezber Takip Sistemi</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;800&family=Nunito:wght@400;700;900&family=Amiri:wght@700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #10B981; --primary-dark: #047857; --accent: #F59E0B; --purple: #8B5CF6; --blue: #3B82F6; --bg: #F3F4F6; --card-bg: #FFFFFF; --text: #1F2937; --text-light: #6B7280; --gold: #FFD700; --excel: #217346; --danger: #EF4444; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--text); min-height: 100vh; display: flex; justify-content: center; overflow-x: hidden; }
        .app-wrapper { width: 100%; max-width: 480px; position: relative; min-height: 100vh; background: var(--bg); padding-bottom: 110px; }

        /* MODALS */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 3000; backdrop-filter: blur(5px); }
        .modal { background: white; width: 90%; max-width: 400px; padding: 25px; border-radius: 25px; text-align: center; animation: popIn 0.3s; position: relative; max-height: 90vh; overflow-y: auto; }
        .modal-close { position: absolute; top: 15px; right: 15px; font-size: 1.4rem; color: #999; cursor: pointer; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-actions { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .btn-confirm { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; flex: 1; }
        .btn-cancel { background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; flex: 1; }
        .reason-btn { width: 100%; padding: 15px; margin-bottom: 10px; border: 2px solid #eee; border-radius: 15px; background: white; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 15px; transition: 0.2s; text-align: left; }
        .reason-btn:hover { background: #f0fdf4; border-color: var(--primary); }

        /* TEBRƒ∞K KARTI STƒ∞LLERƒ∞ */
        #celebration-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.95), rgba(59, 130, 246, 0.95));
            z-index: 9999; display: none; flex-direction: column; justify-content: center; align-items: center;
            color: white; text-align: center; padding: 20px; backdrop-filter: blur(10px);
        }
        .celebration-card {
            background: rgba(255, 255, 255, 0.15); border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 40px; padding: 40px 20px; width: 100%; max-width: 350px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); position: relative;
            animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        @keyframes bounceIn { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .celeb-close { position: absolute; top: 15px; right: 20px; font-size: 2.2rem; cursor: pointer; opacity: 0.8; transition:0.3s; padding:10px; }
        .celeb-close:hover { transform: scale(1.1); opacity: 1; }
        .celeb-icon { font-size: 6rem; margin-bottom: 20px; filter: drop-shadow(0 0 20px rgba(255,215,0,0.6)); animation: float 3s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }
        .celeb-title { font-family: 'Baloo 2', cursive; font-size: 2.2rem; font-weight: 800; line-height: 1.2; margin-bottom: 10px; text-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .celeb-desc { font-size: 1rem; opacity: 0.95; margin-bottom: 30px; font-weight: 500; }
        .share-btn {
            background: white; color: var(--primary); font-family: 'Poppins', sans-serif;
            border: none; padding: 15px 30px; border-radius: 50px; font-weight: 800; font-size: 1rem;
            cursor: pointer; box-shadow: 0 10px 25px rgba(0,0,0,0.2); transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%;
        }
        .share-btn:active { transform: scale(0.95); box-shadow: 0 5px 10px rgba(0,0,0,0.1); }

        /* UI ELEMENTS */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; padding: 30px; overflow-y: auto; }
        .logo-container { padding: 0; overflow: hidden; background: transparent; border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin-bottom: 25px; width: 110px; height: 110px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .login-box { background: white; width: 100%; padding: 25px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); text-align: center; animation: popIn 0.4s ease; margin-bottom: 20px; }
        .login-input { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #eee; border-radius: 10px; font-size: 1rem; outline: none; transition: 0.3s; color: #333; }
        .login-input:focus { border-color: var(--primary); }
        .login-btn { width: 100%; padding: 12px; border: none; border-radius: 10px; background: var(--primary); color: white; font-weight: bold; cursor: pointer; font-size: 1rem; margin-bottom: 10px; transition: 0.2s; }
        .login-btn:active { transform: scale(0.97); }
        .login-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .switch-link { margin-top: 10px; font-size: 0.9rem; color: var(--primary); cursor: pointer; text-decoration: underline; font-weight: 600; display: inline-block; padding: 5px; }
        .register-link { margin-top: 5px; font-size: 0.85rem; color: #666; cursor: pointer; text-decoration: none; display: block; }

        header { 
            background: linear-gradient(135deg, #059669, #10B981); 
            color: white; 
            padding: 25px; 
            border-bottom-left-radius: 30px; 
            border-bottom-right-radius: 30px; 
            min-height: 320px; 
            position: relative; 
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.25); 
            display: flex; 
            flex-direction: column; 
            transition: all 0.3s ease; 
            overflow: hidden;
        }
        header::before { content: ''; position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: rgba(255,255,255,0.1); border-radius: 50%; z-index: 0; }
        header::after { content: ''; position: absolute; bottom: 20px; left: -30px; width: 100px; height: 100px; background: rgba(255,255,255,0.05); border-radius: 50%; z-index: 0; }
        header.hidden { display: none !important; }
        .user-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; position: relative; z-index: 1; }
        .avatar-circle { width: 60px; height: 60px; background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.2rem; border: 2px solid rgba(255,255,255,0.6); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .stats-container { display: flex; flex-direction: column; gap: 8px; align-items: flex-end; }
        .stats-badge { background: rgba(255,255,255,0.15); padding: 6px 14px; border-radius: 12px; font-weight: 700; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.3); box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .stats-badge:active { transform: scale(0.95); }
        .stats-badge.purple { background: linear-gradient(135deg, rgba(139, 92, 246, 0.4), rgba(139, 92, 246, 0.6)); border: 1px solid rgba(255,255,255,0.4); }
        .countdown-box { background: rgba(255,255,255,0.1); border-radius: 20px; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px); box-shadow: inset 0 0 20px rgba(255,255,255,0.05); position: relative; z-index: 1; }
        .timer-label { font-size: 0.75rem; opacity: 0.9; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 2px; }
        .timer-val { font-size: 1.8rem; font-weight: 700; font-family: 'Courier New', monospace; letter-spacing: -1px; text-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .level-container { position: relative; z-index: 2; margin-bottom: 15px; }
        .progress-bg { width: 100%; height: 12px; background: rgba(0,0,0,0.3); border-radius: 20px; overflow: hidden; margin-top: 8px; border: 1px solid rgba(255,255,255,0.15); }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #FCD34D, #F59E0B); width: 0%; transition: width 1s ease; box-shadow: 0 0 15px rgba(245, 158, 11, 0.6); position: relative; }
        .progress-fill::after { content:''; position: absolute; top:0; left:0; right:0; bottom:0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); animation: shine 2s infinite; }
        @keyframes shine { from {transform: translateX(-100%);} to {transform: translateX(100%);} }
        .header-badges-area { background: rgba(0,0,0,0.1); border-radius: 18px; padding: 12px; border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(5px); margin-top: 5px; position: relative; z-index: 1; }
        .badges-scroll { display: flex; gap: 15px; overflow-x: auto; padding: 5px; scrollbar-width: none; }
        .badge-item { min-width: 70px; text-align: center; opacity: 0.6; filter: grayscale(1); transition: 0.3s; transform: scale(0.95); color: rgba(255,255,255,0.8); }
        .badge-item.unlocked { opacity: 1; filter: grayscale(0); transform: scale(1); color: white; }
        .badge-icon { width: 50px; height: 50px; background: rgba(255,255,255,0.95); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.6rem; margin: 0 auto 5px auto; border: 3px solid transparent; color: #333; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .badge-item.unlocked .badge-icon { border-color: var(--gold); box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); }

        .cards-container { margin-top: -25px; padding: 0 20px; position: relative; z-index: 5; transition: margin-top 0.3s; }
        .cards-container.no-margin-top { margin-top: 20px; }
        .card { background: var(--card-bg); border-radius: 24px; padding: 20px; margin-bottom: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.04); border: 1px solid rgba(0,0,0,0.02); }

        .prayer-card { transition: all 0.3s; position: relative; overflow: hidden; border: 2px solid transparent; }
        .active-prayer { border-color: var(--primary); background: #ecfdf5; transform: scale(1.02); box-shadow: 0 10px 25px rgba(16, 185, 129, 0.1); }
        .inactive-time { opacity: 0.75; background: #f9fafb; filter: grayscale(0.5); }
        .prayer-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .btn-row { display: flex; gap: 10px; width: 100%; }
        .btn-action { flex: 1; padding: 12px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; color: white; font-size: 0.9rem; transition: 0.2s; position: relative; overflow: hidden; }
        .btn-tek { background: linear-gradient(135deg, #10B981, #059669); }
        .btn-cem { background: linear-gradient(135deg, #6366f1, #4338ca); }
        
        .market-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .market-item { background: white; border-radius: 20px; padding: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: relative; border: 2px solid transparent; overflow:hidden; }
        .currency-tag { position: absolute; top: 10px; right: 10px; font-size: 0.75rem; padding: 5px 10px; border-radius: 10px; font-weight: 800; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tag-gp { background: var(--accent); }
        .tag-np { background: var(--purple); }
        .market-actions-row { display: flex; gap: 8px; margin-top: 10px; align-items: center; }
        .market-qty-input { width: 45px; padding: 8px; border: 2px solid #f3f4f6; border-radius: 10px; text-align: center; font-weight: bold; color: var(--text); outline: none; }
        .market-buy-btn { flex: 1; padding: 10px; border: none; border-radius: 10px; font-weight: 700; color: white; cursor: pointer; transition: 0.2s; font-size: 0.85rem; }
        .market-buy-btn:active { transform: scale(0.95); }

        .bottom-nav { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background: rgba(255, 255, 255, 0.9); display: flex; justify-content: space-between; padding: 8px; z-index: 1000; border-radius: 40px; box-shadow: 0 15px 40px rgba(0,0,0,0.15); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.6); }
        .nav-item { color: var(--text-light); text-align: center; font-size: 0.75rem; cursor: pointer; padding: 10px 12px; border-radius: 30px; transition: 0.3s; display: flex; align-items: center; gap: 4px; }
        .nav-item i { font-size: 1.1rem; }
        .nav-item span { display: none; font-weight: 600; }
        .nav-item.active { color: white; background: var(--primary); box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3); }
        .nav-item.active span { display: inline-block; }

        .admin-header { background: #1f2937; color: white; padding: 30px; border-radius: 0 0 30px 30px; margin-bottom: 20px; }
        .admin-btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .mgmt-btn { font-size: 0.75rem; padding: 5px 10px; border-radius: 6px; border: none; cursor: pointer; margin-right: 4px; color: white; }
        .excel-btn { background: var(--excel); color: white; border: none; padding: 8px 15px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 5px; margin-bottom: 10px; float: right; }
        .danger-btn { background: var(--danger); color: white; border: none; padding: 8px 15px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 5px; margin-bottom: 10px; float: right; margin-right: 10px; }
        
        .tab-container { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .tab-btn { background: none; border: none; padding: 8px 15px; cursor: pointer; font-weight: 600; color: #999; border-radius: 8px; transition: 0.3s; }
        .tab-btn.active { background: #eff6ff; color: var(--primary); }
        .page { display: none; animation: fadeIn 0.4s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .req-section { margin-bottom: 20px; border: 1px solid #eee; padding: 10px; border-radius: 10px; }
        .req-title { font-size: 0.9rem; font-weight: bold; color: #555; margin-bottom: 10px; border-bottom: 2px solid #eee; padding-bottom: 5px; }

        .ilim-item { border: 1px solid #f3f4f6; border-radius: 16px; margin-bottom: 10px; background: white; overflow: hidden; }
        .ilim-header { padding: 15px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-weight: 600; background: #fdfdfd; }
        .ilim-content { display: none; padding: 20px; border-top: 1px solid #eee; }
        .ilim-item.open .ilim-content { display: block; }
        .audio-player { background: #1f2937; color: white; padding: 10px; border-radius: 12px; display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .play-btn { width: 35px; height: 35px; border-radius: 50%; background: white; color: #1f2937; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        
        /* MODERN HAFTALIK KARNE CSS */
        .report-grid { display: flex; flex-direction: column; gap: 5px; margin-top: 15px; }
        .report-row { display: grid; grid-template-columns: 1.5fr repeat(5, 1fr); gap: 5px; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee; }
        .report-header { font-weight: bold; color: #555; font-size: 0.75rem; background: #f9fafb; padding: 8px 0; border-radius: 8px; }
        .day-label { font-size: 0.75rem; font-weight: 600; color: #374151; }
        .p-cell { display: flex; justify-content: center; align-items: center; height: 30px; width: 30px; border-radius: 50%; font-size: 0.9rem; margin: 0 auto; }
        .p-done { background: #d1fae5; color: #047857; }
        .p-cemaat { background: #e0e7ff; color: #4338ca; border: 2px solid #818cf8; }
        .p-miss { background: #f3f4f6; color: #d1d5db; }
        .summary-card { background: linear-gradient(135deg, #10B981, #059669); color: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; text-align: center; }
        .sum-val { font-size: 1.5rem; font-weight: bold; }
        .sum-label { font-size: 0.8rem; opacity: 0.9; }
        
        /* OYUN ƒ∞√áƒ∞N √ñZEL CSS (UZAY) */
        #game-wrapper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 5000; display: none;
            font-family: 'Press Start 2P', cursive;
        }
        #gameCanvas { display: block; width: 100%; height: 100%; }
        #videoElement {
            position: absolute; bottom: 20px; left: 20px; width: 150px; height: 110px;
            transform: scaleX(-1); border: 3px solid #33ff00; border-radius: 8px;
            opacity: 0.8; z-index: 5010; display: none;
        }
        #game-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0, 0, 0, 0.90); color: #fff; z-index: 5020; text-align: center;
        }
        .game-title { color: #33ff00; text-shadow: 0 0 20px #33ff00; font-size: 2rem; margin-bottom: 10px; line-height: 1.5; text-transform: uppercase; }
        .game-subtitle { font-size: 0.8rem; color: #fff; letter-spacing: 3px; margin-bottom: 30px; opacity: 0.8; }
        .game-btn { margin-top: 20px; padding: 15px 30px; background: #33ff00; color: #000; border: none; font-family: 'Press Start 2P', cursive; font-size: 1rem; cursor: pointer; box-shadow: 0 0 15px #33ff00; transition: 0.2s; }
        .game-btn:hover { background: #fff; transform: scale(1.05); }
        .game-close-btn { position: absolute; top: 20px; right: 20px; background: red; color: white; padding: 10px; font-family: 'Poppins', sans-serif; border: none; cursor: pointer; z-index: 5030; border-radius: 5px; font-weight: bold; }
        .announce-item { background: #fff; padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; }
        
        /* QUIZ STYLES */
        .quiz-opt { padding: 15px; margin-bottom: 10px; background: #f3f4f6; border-radius: 10px; cursor: pointer; transition: 0.2s; font-size: 0.9rem; border: 2px solid transparent; }
        .quiz-opt:hover { background: #e5e7eb; }
        .quiz-opt.correct { background: #d1fae5; border-color: #10b981; color: #065f46; font-weight: bold; }
        .quiz-opt.wrong { background: #fee2e2; border-color: #ef4444; color: #991b1b; }
        .timer-bar-wrap { width: 100%; height: 6px; background: #eee; border-radius: 10px; overflow: hidden; margin-bottom: 15px; }
        .timer-bar { height: 100%; background: var(--primary); width: 100%; transition: width 1s linear; }

        /* ARAP√áA Lƒ∞Gƒ∞ √ñZEL CSS */
        #arabic-game-wrapper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #f9f9f9; background-image: url('https://www.transparenttextures.com/patterns/notebook.png');
            z-index: 6000; display: none; flex-direction: column; overflow-y: auto;
            font-family: 'Nunito', sans-serif;
        }
        #arabic-game-wrapper .arabic-btn { border: none; border-radius: 50px; font-family: 'Nunito', sans-serif; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.1s; }
        #arabic-game-wrapper .arabic-btn:active { transform: translateY(4px); }
        #arabic-game-wrapper .loading-logo, #arabic-game-wrapper .logo-text {
            font-family: 'Baloo 2', cursive; font-weight: 800; font-size: 2.5rem; color: white; text-shadow: 3px 3px 0 #f1c40f; -webkit-text-stroke: 1.5px #8e44ad; white-space: nowrap; margin-bottom: 20px;
        }
        #arabic-game-wrapper .logo-text-menu { color: #8e44ad; -webkit-text-stroke: 1.5px white; }
        #arabic-game-wrapper .arabic-card { background: white; padding: 30px; border-radius: 25px; text-align: center; width: 90%; max-width: 400px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); margin: 0 auto; }
        #arabic-game-wrapper select { width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #eee; margin-bottom: 20px; background: #fafafa; font-weight: bold; font-size: 1.1rem; color: #333; cursor: pointer; }
        #arabic-game-wrapper .start-btn { width: 100%; padding: 15px; font-size: 1.3rem; background: linear-gradient(to bottom, #9b59b6, #8e44ad); color: white; box-shadow: 0 5px 0 #6c3483; margin-top: 10px; border:none; border-radius:50px; cursor:pointer; }
        #arabic-game-wrapper .top-bar { background: #8e44ad; padding: 10px 20px; width: 100%; display: flex; justify-content: space-between; color: white; align-items:center; }
        #arabic-game-wrapper .question-area { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; padding-top:20px; }
        #arabic-game-wrapper .word-card { background: white; padding: 20px 40px; border-radius: 30px; box-shadow: 0 8px 0 #e0e0e0; margin-bottom: 20px; text-align: center; border: 2px solid #f5f5f5; min-width: 250px; cursor: pointer; transition: transform 0.1s; }
        #arabic-game-wrapper .word-card:active { transform: scale(0.98); border-color: #f1c40f; }
        #arabic-game-wrapper .arabic-word { font-family: 'Amiri', serif; font-size: 4rem; color: #8e44ad; font-weight: bold; }
        #arabic-game-wrapper .sound-hint { color: #8e44ad; font-size: 0.9rem; margin-top: 5px; opacity: 0.8; font-weight: bold; }
        #arabic-game-wrapper .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 90%; max-width: 500px; }
        #arabic-game-wrapper .option-btn { background: white; border: 2px solid #eee; padding: 15px; border-radius: 15px; font-size: 1.1rem; color: #555; box-shadow: 0 4px 0 #ddd; min-height: 60px; cursor: pointer; font-weight: bold; width:100%; }
        #arabic-game-wrapper .option-btn.correct { background: #2ecc71; color: white; border-color: #27ae60; box-shadow: 0 4px 0 #219150; }
        #arabic-game-wrapper .option-btn.wrong { background: #e74c3c; color: white; border-color: #c0392b; box-shadow: 0 4px 0 #a93226; animation: shake 0.4s; }
        #arabic-game-wrapper .rank-card { margin-top: 15px; padding: 15px; border: 3px solid #f1c40f; max-height: 150px; overflow-y: auto; width: 90%; max-width: 400px; background: white; border-radius: 20px; margin: 15px auto; }
        #arabic-game-wrapper .rank-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #eee; font-weight: bold; color: #555; }
        #arabic-game-wrapper .empty-rank { color: #999; font-style: italic; font-size: 0.9rem; margin-top: 10px; }

    </style>
</head>
<body>

<div id="celebration-overlay" onclick="document.getElementById('celebration-overlay').style.display='none'">
    <div class="celebration-card" onclick="event.stopPropagation()">
        <div class="celeb-close" onclick="document.getElementById('celebration-overlay').style.display='none'">&times;</div>
        <div class="celeb-icon" id="celeb-icon">üèÜ</div>
        <div class="celeb-title" id="celeb-title">TEBRƒ∞KLER!</div>
        <div class="celeb-desc" id="celeb-desc">Yeni bir rozet kazandƒ±n!</div>
        <button class="share-btn" onclick="document.getElementById('celebration-overlay').style.display='none'">Harika!</button>
    </div>
</div>

<div id="arabic-game-wrapper">
    <div id="arabic-menu-screen" style="display:flex; flex-direction: column; align-items: center; justify-content: center; height:100%;">
        <div class="logo-text logo-text-menu">ARAP√áA Lƒ∞Gƒ∞</div>
        <div class="arabic-card">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
                <label style="color:#777; font-size:0.9rem;">Yarƒ±≈ümacƒ±:</label>
                <span id="ar-userDisplay" style="color:#8e44ad; font-weight:bold; font-size:1.1rem;">...</span>
            </div>
            
            <label style="display:block; text-align:left; color:#777; margin-bottom:5px; font-size:0.9rem;">Sƒ±nƒ±fƒ±nƒ± Se√ß:</label>
            <select id="ar-classSelect">
                <option value="5">5. Sƒ±nƒ±f</option>
                <option value="6">6. Sƒ±nƒ±f</option>
                <option value="7">7. Sƒ±nƒ±f</option>
                <option value="8">8. Sƒ±nƒ±f</option>
            </select>
            
            <button class="start-btn" onclick="ArabicLeague.startGame()">OYUNA BA≈ûLA</button>
            <button class="start-btn" style="background:#ef4444; margin-top:10px;" onclick="ArabicLeague.close()">√áIKI≈û</button>
        </div>
        <div class="rank-card">
            <div style="text-align:center; color:#f39c12; font-weight:bold; margin-bottom:5px;">üèÜ BU HAFTANIN Lƒ∞DERLERƒ∞</div>
            <div id="ar-leaderboardList">
                <div class="empty-rank">Y√ºkleniyor...</div>
            </div>
        </div>
    </div>

    <div id="arabic-play-screen" style="display:none; flex-direction: column; align-items: center; height:100%;">
        <div class="top-bar">
            <div onclick="ArabicLeague.goMenu()" style="cursor:pointer; font-weight:bold;"><i class="fas fa-arrow-left"></i> Men√º</div>
            <div style="font-weight:bold;">‚≠ê <span id="ar-scoreDisplay">0</span></div>
            <div style="font-weight:bold;">‚ù§Ô∏è <span id="ar-livesDisplay">3</span></div>
        </div>
        <div class="question-area">
            <div class="word-card" onclick="ArabicLeague.playAudio()">
                <div class="arabic-word" id="ar-questionText">...</div>
                <div class="sound-hint"><i class="fas fa-volume-up"></i> Dinle</div>
            </div>
            <div class="options-grid" id="ar-optionsGrid"></div>
        </div>
    </div>
    
    <div id="arabic-loading" style="position:absolute; top:0; left:0; width:100%; height:100%; background:#8e44ad; color:white; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:6005;">
        <div class="logo-text">ARAP√áA Lƒ∞Gƒ∞</div>
        <div>Veriler Y√ºkleniyor...</div>
    </div>
</div>

<div id="game-wrapper">
    <video id="videoElement" playsinline></video>
    <canvas id="gameCanvas"></canvas>
    <button class="game-close-btn" onclick="SpaceRunner.closeGame()">√áIKI≈û X</button>
    <div id="game-overlay">
        <h1 class="game-title">UZAY MACERASI</h1>
        <h2 class="game-subtitle">EL ƒ∞LE KONTROL</h2>
        <p style="font-size:0.7rem; color:#ccc; line-height:1.6; margin-bottom:20px;">ELƒ∞Nƒ∞ YUKARI/A≈ûAƒûI HAREKET ETTƒ∞R.<br>ENGELLERDEN KA√áIN.</p>
        <p style="font-size:0.6rem; color:#666;">Kamera izni gerektirir.</p>
        <button class="game-btn" onclick="SpaceRunner.startGame()">BA≈ûLA</button>
    </div>
</div>

<div class="app-wrapper">
    <div id="login-screen">
        <div class="logo-container">
            <i class="fas fa-kaaba" style="font-size: 3.5rem; color: #fff;"></i>
        </div>
        <h2 style="font-family: 'Baloo 2', cursive; margin-bottom: 20px; font-size: 1.8rem; text-shadow: 0 2px 10px rgba(0,0,0,0.1);">Namaz & Ezber</h2>
        
        <div id="student-login-form" class="login-box">
            <h3 style="margin-bottom: 15px; color: #444;">√ñƒürenci Giri≈üi</h3>
            <input type="text" id="username" class="login-input" placeholder="Kullanƒ±cƒ± Adƒ±" autocomplete="off">
            <input type="password" id="password" class="login-input" placeholder="≈ûifre">
            <button class="login-btn" id="btn-login-student" onclick="handleStudentLogin()">Giri≈ü Yap</button>
            <div class="register-link" onclick="document.getElementById('student-login-form').style.display='none'; document.getElementById('student-register-form').style.display='block';">Kayƒ±t Ol</div>
            <div class="switch-link" onclick="document.getElementById('student-login-form').style.display='none'; document.getElementById('teacher-login-form').style.display='block';">√ñƒüretmen Giri≈üi &raquo;</div>
        </div>

        <div id="student-register-form" class="login-box" style="display:none;">
            <h3 style="margin-bottom: 15px; color: #444;">Yeni Kayƒ±t</h3>
            <input type="text" id="reg-username" class="login-input" placeholder="Ad Soyad (Kullanƒ±cƒ± Adƒ±)" autocomplete="off">
            <input type="password" id="reg-password" class="login-input" placeholder="≈ûifre">
            <input type="text" id="reg-school" class="login-input" placeholder="Okul No">
            <select id="reg-class" class="login-input" style="background:white;">
                <option value="">Sƒ±nƒ±f Se√ß</option>
                <option value="5A">5-A</option>
                <option value="5B">5-B</option>
                <option value="6A">6-A</option>
                <option value="6B">6-B</option>
                <option value="7A">7-A</option>
                <option value="7B">7-B</option>
                <option value="8A">8-A</option>
                <option value="8B">8-B</option>
            </select>
            <input type="text" id="reg-security-code" class="login-input" placeholder="Okul Kodu (√ñƒüretmenden al)">
            <button class="login-btn" id="reg-submit-btn">Kayƒ±t Ol</button>
            <button class="login-btn" style="background:#ddd; color:#555;" id="btn-cancel-register">ƒ∞ptal</button>
        </div>

        <div id="teacher-login-form" class="login-box" style="display:none;">
            <h3 style="margin-bottom: 15px; color: #444;">√ñƒüretmen Giri≈üi</h3>
            <input type="password" id="teacher-password" class="login-input" placeholder="Y√∂netici ≈ûifresi">
            <button class="login-btn" onclick="handleTeacherLogin()">Y√∂netici Giri≈üi</button>
            <div class="switch-link" onclick="document.getElementById('teacher-login-form').style.display='none'; document.getElementById('student-login-form').style.display='block';">&laquo; √ñƒürenci Giri≈üi</div>
        </div>
        
        <p style="font-size: 0.75rem; opacity: 0.7; margin-top: 20px;">v2.1 &copy; 2024</p>
    </div>

    <header id="main-header" class="hidden">
        <div class="user-top">
            <div class="avatar-circle">
                <i class="fas fa-user-graduate" style="color: white;"></i>
            </div>
            <div class="stats-container">
                <div class="stats-badge"><i class="fas fa-star" style="color: #FCD34D;"></i> <span id="user-points">0</span> GP</div>
                <div class="stats-badge purple"><i class="fas fa-mosque" style="color: #fff;"></i> <span id="namaz-points">0</span> NP</div>
            </div>
        </div>

        <div class="countdown-box">
            <div>
                <div class="timer-label">ƒ∞FTARA KALAN</div>
                <div class="timer-val" id="iftar-timer">--:--</div>
            </div>
            <i class="fas fa-moon" style="font-size: 2.5rem; color: rgba(255,255,255,0.8);"></i>
        </div>

        <div class="level-container">
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; font-weight: 600;">
                <span>Seviye <span id="user-lvl">1</span></span>
                <span id="next-lvl-points">500 GP kaldƒ±</span>
            </div>
            <div class="progress-bg">
                <div class="progress-fill" id="xp-bar"></div>
            </div>
        </div>
        
        <div class="header-badges-area">
            <div class="badges-scroll" id="my-badges-list">
                </div>
        </div>
    </header>

    <div id="dashboard" style="display: none;">
        <div class="cards-container">
            
            <div class="card" style="background: linear-gradient(135deg, #059669, #047857); color: white; position: relative; overflow: hidden; border: none; box-shadow: 0 10px 20px rgba(5, 150, 105, 0.3);">
                <i class="fas fa-mosque" style="position: absolute; right: -20px; bottom: -20px; font-size: 8rem; opacity: 0.15; color: #fff; transform: rotate(-10deg);"></i>
                <i class="fas fa-moon" style="position: absolute; left: 10px; top: 10px; font-size: 3rem; opacity: 0.1; color: #fff;"></i>
                <div style="position: relative; z-index: 2;">
                    <div style="background: rgba(255,255,255,0.2); width: fit-content; padding: 5px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; margin-bottom: 10px; backdrop-filter: blur(5px);">
                        <i class="fas fa-star" style="color: #FCD34D;"></i> √áok Yakƒ±nda
                    </div>
                    <h3 style="font-family: 'Baloo 2', cursive; font-size: 1.6rem; margin-bottom: 5px; line-height: 1.2;">
                        Ramazan √ñzel
                    </h3>
                    <p style="font-size: 0.95rem; opacity: 0.9; margin-bottom: 0;">
                        Ramazan ayƒ±na √∂zel etkinlikler, yarƒ±≈ümalar ve s√ºrpriz √∂d√ºller √ßok yakƒ±nda burada!
                    </p>
                </div>
            </div>
            <div class="card" id="daily-question-card" style="background: linear-gradient(135deg, #3B82F6, #2563EB); color: white; display: none; position: relative; overflow: hidden; box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);">
                <i class="fas fa-question" style="position:absolute; right:-20px; bottom:-30px; font-size:9rem; opacity:0.1; transform:rotate(-20deg);"></i>
                <div style="display:flex; justify-content:space-between; align-items:flex-start; position:relative; z-index:2;">
                    <div>
                        <div style="background:rgba(255,255,255,0.2); width:fit-content; padding:4px 10px; border-radius:20px; font-size:0.7rem; font-weight:bold; margin-bottom:5px;">
                            <i class="fas fa-gift"></i> G√ºnl√ºk Fƒ±rsat
                        </div>
                        <h3 style="font-size:1.4rem; font-weight:700; margin-bottom:5px;">Bil Bakalƒ±m?</h3>
                        <p style="font-size:0.85rem; opacity:0.95; max-width:200px; line-height:1.4;">
                            G√ºn√ºn sorularƒ±nƒ± doƒüru bil,<br>
                            <span style="font-weight:800; color:#FCD34D; font-size:1.1rem;">+50 GP</span> kazan!
                        </p>
                    </div>
                    <div style="background:white; color:#2563EB; width:50px; height:50px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.5rem; box-shadow:0 5px 15px rgba(0,0,0,0.2); cursor:pointer; transition:0.2s;" onclick="openDailyQuiz()">
                        <i class="fas fa-play"></i>
                    </div>
                </div>
            </div>

            <div class="card" id="weekly-task-card" style="display: none; border-left: 5px solid var(--accent);">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <h3 style="font-size: 1.1rem; color: var(--accent);"><i class="fas fa-flag"></i> Haftanƒ±n G√∂revi</h3>
                    <span id="challenge-reward" style="background: var(--accent); color: white; padding: 2px 8px; border-radius: 8px; font-size: 0.8rem; font-weight: bold;">+100 GP</span>
                </div>
                <p id="challenge-desc" style="font-size: 0.9rem; margin-bottom: 15px;">Bu hafta 5 vakit namazƒ±nƒ± eksiksiz kƒ±l.</p>
                <button id="challenge-btn" class="btn-action" style="background: var(--accent); width: 100%; color: white;">Tamamladƒ±m</button>
            </div>

            <div id="prayers-list"></div>
        </div>
    </div>

    <div id="ilim-screen" style="display: none;">
        <div style="padding: 20px;">
            <h2 style="margin-bottom: 15px; font-family: 'Baloo 2'; color: var(--text);">Ezberlerim</h2>
            <div id="ilim-list"></div>
        </div>
    </div>

    <div id="market-screen" style="display: none;">
        <div style="padding: 20px;">
            <div style="background: linear-gradient(135deg, #8B5CF6, #6D28D9); color: white; padding: 20px; border-radius: 20px; margin-bottom: 20px; text-align: center; box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);">
                <div style="font-size: 0.9rem; opacity: 0.9;">Harcayabilir Bakiye</div>
                <div style="font-size: 2.2rem; font-weight: 800; font-family: 'Nunito'; margin: 5px 0;">
                    <span id="market-np">0</span> <span style="font-size: 1rem;">NP</span>
                </div>
                <div style="font-size: 0.8rem; background: rgba(0,0,0,0.2); padding: 5px 10px; border-radius: 15px; display: inline-block;">
                    Sadece Namaz Puanƒ± (NP) ge√ßerlidir
                </div>
            </div>
            <h3 style="margin-bottom: 15px; font-family: 'Baloo 2';">Maƒüaza</h3>
            <div id="market-list" class="market-grid"></div>
        </div>
    </div>

    <div id="games-screen" style="display: none;">
        <div style="padding: 20px;">
            <h2 style="margin-bottom: 20px; font-family: 'Baloo 2';">Oyun Alanƒ±</h2>
            
            <div class="card" style="background: linear-gradient(135deg, #111, #333); color: #33ff00; border: 2px solid #33ff00; cursor: pointer;" onclick="document.getElementById('game-wrapper').style.display='block';">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="font-family: 'Press Start 2P'; font-size: 1rem; margin-bottom: 5px;">UZAY MACERASI</h3>
                        <p style="color: white; font-size: 0.8rem;">Engellerden ka√ß, puanlarƒ± topla!</p>
                    </div>
                    <i class="fas fa-rocket" style="font-size: 2rem;"></i>
                </div>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #8e44ad, #9b59b6); color: white; cursor: pointer;" onclick="window.ArabicLeague.open()">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="font-family: 'Baloo 2'; font-size: 1.4rem; margin-bottom: 5px;">Arap√ßa Ligi</h3>
                        <p style="font-size: 0.85rem; opacity: 0.9;">Kelime bilgini yarƒ±≈ütƒ±r, sƒ±ralamaya gir!</p>
                    </div>
                    <i class="fas fa-trophy" style="font-size: 2rem; color: #f1c40f;"></i>
                </div>
            </div>

        </div>
    </div>

    <div class="bottom-nav hidden" id="bottom-nav">
        <div class="nav-item active" id="nav-home"><i class="fas fa-mosque"></i> <span>Namaz</span></div>
        <div class="nav-item" id="nav-ilim"><i class="fas fa-book-open"></i> <span>Ezber</span></div>
        <div class="nav-item" id="nav-market"><i class="fas fa-shopping-basket"></i> <span>Market</span></div>
        <div class="nav-item" id="nav-games"><i class="fas fa-gamepad"></i> <span>Oyunlar</span></div>
        <div class="nav-item" id="nav-logout"><i class="fas fa-sign-out-alt"></i></div>
    </div>
</div>

<div id="teacher-app" style="display:none;">
    <div class="admin-header">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Y√∂netim Paneli</h2>
            <button id="tea-logout-btn" style="background:rgba(255,255,255,0.2); border:none; color:white; padding:5px 15px; border-radius:20px; cursor:pointer;">√áƒ±kƒ±≈ü</button>
        </div>
        <p style="opacity:0.8; font-size:0.9rem;">√ñƒürenci Takip & Sƒ±ralama</p>
    </div>

    <div style="padding: 20px; background: white; border-radius: 30px; min-height: 500px; position: relative; top: -30px;">
        <div class="tab-container">
            <button class="tab-btn active" id="tea-nav-home">Genel</button>
            <button class="tab-btn" id="tea-nav-students">√ñƒürenciler</button>
            <button class="tab-btn" id="tea-nav-market">Market</button>
            <button class="tab-btn" id="tea-nav-requests">ƒ∞stekler</button>
        </div>

        <div id="tea-page-home" class="page active">
            <div class="req-section">
                <div class="req-title">Haftanƒ±n G√∂revi</div>
                <input type="text" id="admin-task" placeholder="√ñrn: 5 vakit namazƒ± cemaatle kƒ±l" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 5px;">
                <input type="number" id="admin-points" placeholder="√ñd√ºl Puanƒ± (GP)" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 5px;">
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px;">
                    <input type="date" id="admin-task-start" style="padding: 10px; border: 1px solid #ddd; border-radius: 10px; font-size: 0.9rem;" placeholder="Ba≈ülangƒ±√ß">
                    <input type="date" id="admin-task-end" style="padding: 10px; border: 1px solid #ddd; border-radius: 10px; font-size: 0.9rem;" placeholder="Biti≈ü">
                </div>
                <button id="update-task-btn" class="admin-btn">G√∂revi G√ºncelle</button>
            </div>

            <div class="req-section">
                <div class="req-title">Sƒ±ralama (GP)</div>
                <div id="leaderboard" style="display: flex; flex-direction: column; gap: 5px;"></div>
            </div>
        </div>

        <div id="tea-page-students" class="page">
            <button class="danger-btn" onclick="window.resetAllStudentsWrapper()"><i class="fas fa-trash"></i> T√ºm Puanlarƒ± Sƒ±fƒ±rla</button>
            <button class="excel-btn" onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Excel ƒ∞ndir</button>
            <div style="clear:both; margin-bottom:10px;"></div>
            <input type="text" id="student-search" placeholder="√ñƒürenci Ara..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 10px;">
            <div id="students-list"></div>
        </div>

        <div id="tea-page-market" class="page">
            <div class="req-section">
                <div class="req-title">Yeni √úr√ºn Ekle</div>
                <div style="display:grid; grid-template-columns: 2fr 1fr; gap:5px; margin-bottom:5px;">
                    <input type="text" id="m-name" placeholder="√úr√ºn Adƒ±" style="padding:8px; border:1px solid #ddd; border-radius:8px; font-size:0.8rem; width:100%;">
                    <input type="number" id="m-price" placeholder="Fiyat" style="padding:8px; border:1px solid #ddd; border-radius:8px; font-size:0.8rem; width:100%;">
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                    <select id="m-currency" style="padding:8px; border:1px solid #ddd; border-radius:8px; width:100%;">
                        <option value="gp">GP (Puan)</option>
                        <option value="np">NP (Namaz)</option>
                    </select>
                    <input type="text" id="m-icon" placeholder="Emoji (‚úèÔ∏è)" style="padding:8px; border:1px solid #ddd; border-radius:8px; width:100%;">
                </div>
                <div style="margin-top:5px;">
                    <input type="number" id="m-stock" placeholder="Stok Adedi (Bo≈ü = Sƒ±nƒ±rsƒ±z)" style="padding:8px; border:1px solid #ddd; border-radius:8px; width:100%;">
                </div>
                <button id="add-item-btn" class="admin-btn" style="margin-top:10px; font-size:0.9rem;">Ekle</button>
            </div>
            <div id="admin-market-list" class="market-grid"></div>
        </div>

        <div id="tea-page-requests" class="page">
            <div id="requests-list"></div>
        </div>
    </div>
</div>

<div id="quiz-modal" class="modal-overlay">
    <div class="modal">
        <div class="modal-close" onclick="closeDailyQuiz()">&times;</div>
        <div id="quiz-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <span id="quiz-q-num" style="font-weight:bold; color:#666;">Soru 1/2</span>
                <span id="quiz-score" style="font-weight:bold; color:var(--primary);">Puan: 0</span>
            </div>
            <div class="timer-bar-wrap"><div class="timer-bar" id="quiz-timer-bar"></div></div>
            <h3 id="quiz-question-text" style="margin:20px 0; font-size:1.1rem; min-height:60px;">Soru Y√ºkleniyor...</h3>
            <div id="quiz-options"></div>
        </div>
    </div>
</div>

<audio id="audio-element" style="display:none;"></audio>
</div>
    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion, onSnapshot, collection, addDoc, query, where, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // --- FIREBASE AYARLARI (L√ºtfen kendi ayarlarƒ±nƒ±zla deƒüi≈ütirin veya mevcutsa dokunmayƒ±n) ---
    const firebaseConfig = {
        apiKey: "AIzaSyD-YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "SENDER_ID",
        appId: "APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    // -----------------------------------------------------------------------------------------

    let currentUser = null;
    let currentGlobalTask = null;

    // --- YARDIMCI FONKSƒ∞YONLAR ---
    window.showAlert = (title, msg, icon = "info") => {
        alert(`${icon} ${title}\n\n${msg}`); // Basit alert, istenirse sweetalert eklenebilir
    };

    // --- Gƒ∞Rƒ∞≈û ƒ∞≈ûLEMLERƒ∞ ---
    window.handleStudentLogin = async () => {
        const u = document.getElementById('username').value.trim();
        const p = document.getElementById('password').value.trim();
        if (!u || !p) return window.showAlert("Hata", "Kullanƒ±cƒ± adƒ± ve ≈üifre girin.", "‚ö†Ô∏è");

        const docRef = doc(db, "users", u);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists() && docSnap.data().password === p) {
            currentUser = { id: u, ...docSnap.data() };
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-header').classList.remove('hidden');
            document.getElementById('bottom-nav').classList.remove('hidden');
            document.getElementById('dashboard').style.display = 'block';
            loadUserData();
            listenToTask(); // G√∂rev dinlemeyi ba≈ülat
        } else {
            window.showAlert("Hata", "Yanlƒ±≈ü kullanƒ±cƒ± adƒ± veya ≈üifre.", "‚õî");
        }
    };

    window.handleTeacherLogin = async () => {
        const p = document.getElementById('teacher-password').value;
        const docRef = doc(db, "global", "admin");
        const docSnap = await getDoc(docRef);

        if (docSnap.exists() && docSnap.data().password === p) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('teacher-app').style.display = 'block';
            loadAdminData();
        } else {
            window.showAlert("Hata", "Yanlƒ±≈ü ≈üifre.", "‚õî");
        }
    };

    // --- √ñƒûRENCƒ∞ VERƒ∞ Y√ñNETƒ∞Mƒ∞ ---
    function loadUserData() {
        // Kullanƒ±cƒ± verilerini anlƒ±k dinle
        onSnapshot(doc(db, "users", currentUser.id), (doc) => {
            currentUser = { id: currentUser.id, ...doc.data() };
            updateUI();
        });

        // ƒ∞ftar Sayacƒ±
        setInterval(() => {
            const now = new Date();
            // Basit iftar saati (√ñrn: 19:30) - Ger√ßek API baƒülanabilir
            const iftar = new Date(); iftar.setHours(19, 30, 0);
            if (now > iftar) iftar.setDate(iftar.getDate() + 1);
            const diff = iftar - now;
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            document.getElementById('iftar-timer').innerText = `${h}:${m < 10 ? '0'+m : m}`;
        }, 10000);
    }

    function updateUI() {
        document.getElementById('user-points').innerText = currentUser.points || 0;
        document.getElementById('namaz-points').innerText = currentUser.namazPoints || 0;
        document.getElementById('market-np').innerText = currentUser.namazPoints || 0;
        
        // Seviye Hesaplama
        const lvl = Math.floor((currentUser.points || 0) / 500) + 1;
        document.getElementById('user-lvl').innerText = lvl;
        const nextLvl = lvl * 500;
        const remain = nextLvl - (currentUser.points || 0);
        document.getElementById('next-lvl-points').innerText = `${remain} GP kaldƒ±`;
        
        const percent = ((500 - remain) / 500) * 100;
        document.getElementById('xp-bar').style.width = `${percent}%`;

        // Rozetleri Listele
        const badgeList = document.getElementById('my-badges-list');
        badgeList.innerHTML = '';
        const badges = [
            { id: 'b1', icon: 'üïå', name: 'ƒ∞lk Namaz' },
            { id: 'b2', icon: '‚ö°', name: 'Hƒ±zlƒ± Ezber' },
            { id: 'b3', icon: 'üöÄ', name: 'Uzay Yolcusu' }
        ];
        
        badges.forEach(b => {
            const hasIt = (currentUser.badges || []).includes(b.id);
            const div = document.createElement('div');
            div.className = `badge-item ${hasIt ? 'unlocked' : ''}`;
            div.innerHTML = `<div class="badge-icon">${b.icon}</div><div>${b.name}</div>`;
            badgeList.appendChild(div);
        });

        renderPrayers();
        renderIlim();
    }

    // --- NAMAZ Lƒ∞STESƒ∞ ---
    function renderPrayers() {
        const pList = document.getElementById('prayers-list');
        pList.innerHTML = '';
        const times = ['Sabah', '√ñƒüle', 'ƒ∞kindi', 'Ak≈üam', 'Yatsƒ±'];
        const today = new Date().toISOString().split('T')[0];
        const history = currentUser.prayerHistory || {};

        times.forEach((t, i) => {
            const status = history[`${today}_${i}`]; // 'tek', 'cem', null
            let html = `
            <div class="card prayer-card ${status ? 'active-prayer' : ''}">
                <div class="prayer-header">
                    <span style="font-weight:bold;"><i class="fas fa-clock"></i> ${t} Namazƒ±</span>
                    ${status ? '<i class="fas fa-check-circle" style="color:var(--primary);"></i>' : ''}
                </div>
                ${!status ? `
                <div class="btn-row">
                    <button class="btn-action btn-tek" onclick="markPrayer(${i}, 'tek')">Tek Ba≈üƒ±na (+10)</button>
                    <button class="btn-action btn-cem" onclick="markPrayer(${i}, 'cem')">Cemaatle (+20)</button>
                </div>` : `<div style="text-align:center; font-size:0.8rem; color:green;">Tamamlandƒ± (${status === 'cem' ? 'Cemaatle' : 'Tek'})</div>`}
            </div>`;
            pList.innerHTML += html;
        });
    }

    window.markPrayer = async (index, type) => {
        const today = new Date().toISOString().split('T')[0];
        const key = `${today}_${index}`;
        const points = type === 'cem' ? 20 : 10;
        
        await updateDoc(doc(db, "users", currentUser.id), {
            [`prayerHistory.${key}`]: type,
            namazPoints: (currentUser.namazPoints || 0) + points,
            points: (currentUser.points || 0) + points // GP de artar
        });
        
        window.showAlert("Ma≈üallah!", `${points} NP kazandƒ±n. Allah kabul etsin.`, "ü§≤");
        confetti();
    };

    // --- G√ñREV Sƒ∞STEMƒ∞ (TARƒ∞H D√úZELTMESƒ∞ BURADA) ---
    function listenToTask() {
        onSnapshot(doc(db, "global", "task"), (docSnap) => {
            if (docSnap.exists()) {
                currentGlobalTask = docSnap.data();
                const taskCard = document.getElementById('weekly-task-card');
                
                // --- TARƒ∞H KONTROL√ú ---
                const now = new Date();
                let isVisible = true;
                
                if (currentGlobalTask.startDate) {
                    const start = new Date(currentGlobalTask.startDate);
                    if (now < start) isVisible = false;
                }
                
                if (currentGlobalTask.endDate) {
                    const end = new Date(currentGlobalTask.endDate);
                    // Biti≈ü g√ºn√ºn√ºn sonuna kadar ge√ßerli olsun (23:59:59)
                    end.setHours(23, 59, 59, 999);
                    if (now > end) isVisible = false;
                }

                // G√∂rev metni yoksa veya tarih tutmuyorsa gizle
                if (!currentGlobalTask.text || !isVisible) {
                    taskCard.style.display = 'none';
                    return;
                }
                // ---------------------

                taskCard.style.display = 'block';
                document.getElementById('challenge-desc').innerText = currentGlobalTask.text;
                document.getElementById('challenge-reward').innerText = `+${currentGlobalTask.reward} GP`;

                // Kullanƒ±cƒ± yapmƒ±≈ü mƒ±?
                const done = (currentUser.completedTasks || []).includes(currentGlobalTask.id);
                const btn = document.getElementById('challenge-btn');
                if (done) {
                    btn.innerText = "Tamamlandƒ±";
                    btn.disabled = true;
                    btn.style.background = "#ccc";
                } else {
                    btn.innerText = "Tamamladƒ±m";
                    btn.disabled = false;
                    btn.style.background = "var(--accent)";
                    btn.onclick = async () => {
                        // Onaya g√∂nder
                        await addDoc(collection(db, "requests"), {
                            type: 'task',
                            user: currentUser.id,
                            userName: currentUser.name || currentUser.id,
                            itemId: currentGlobalTask.id,
                            taskText: currentGlobalTask.text,
                            reward: currentGlobalTask.reward,
                            date: new Date().toISOString(),
                            status: 'pending'
                        });
                        
                        // Bekleyenlere ekle
                        await updateDoc(doc(db, "users", currentUser.id), {
                            pendingTasks: arrayUnion(currentGlobalTask.id)
                        });
                        
                        btn.innerText = "Onay Bekliyor";
                        btn.disabled = true;
                    };
                }
            }
        });
    }

    // --- MARKET ƒ∞≈ûLEMLERƒ∞ (0 Gƒ∞RME SORUNU D√úZELTMESƒ∞ BURADA) ---
    function renderMarket() {
        const list = document.getElementById('market-list');
        list.innerHTML = 'Y√ºkleniyor...';
        
        // √úr√ºnleri √ßek
        getDocs(collection(db, "market")).then(snap => {
            list.innerHTML = '';
            snap.forEach(docSnap => {
                const item = { id: docSnap.id, ...docSnap.data() };
                
                const div = document.createElement('div');
                div.className = 'market-item';
                div.innerHTML = `
                    <div class="currency-tag ${item.currency === 'np' ? 'tag-np' : 'tag-gp'}">${item.price} ${item.currency.toUpperCase()}</div>
                    <div style="font-size:2.5rem;">${item.icon || 'üì¶'}</div>
                    <div style="font-weight:bold; margin:5px 0;">${item.name}</div>
                    <div style="font-size:0.8rem; color:#888;">Stok: ${item.stock === '' ? 'Sƒ±nƒ±rsƒ±z' : item.stock}</div>
                    <div class="market-actions-row">
                        <input type="number" id="qty-${item.id}" class="market-qty-input" value="1" min="1">
                        <button id="btn-${item.id}" class="market-buy-btn" style="background:${item.currency === 'np' ? 'var(--purple)' : 'var(--accent)'}">SATIN AL</button>
                    </div>
                `;
                list.appendChild(div);

                // Button Event
                document.getElementById(`btn-${item.id}`).onclick = async () => {
                    const qtyInput = document.getElementById(`qty-${item.id}`);
                    const qty = parseInt(qtyInput.value);

                    // --- SIFIR VE NEGATƒ∞F SAYI KONTROL√ú (D√úZELTME) ---
                    if (!qty || qty <= 0) {
                        window.showAlert("Hata", "L√ºtfen ge√ßerli bir miktar (en az 1) giriniz.", "‚ö†Ô∏è");
                        return; // ƒ∞≈ülemi durdur, sunucuya g√∂nderme
                    }
                    // --------------------------------------------------

                    // Bakiye kontrol√º
                    const userBal = item.currency === 'np' ? (currentUser.namazPoints || 0) : (currentUser.points || 0);
                    const totalCost = item.price * qty;

                    if (userBal < totalCost) {
                        window.showAlert("Yetersiz Bakiye", "Puanƒ±n yetmiyor.", "üòî");
                        return;
                    }

                    if (item.stock !== "" && parseInt(item.stock) < qty) {
                        window.showAlert("Stok Yok", "Yeterli stok yok.", "üì¶");
                        return;
                    }

                    // Onaya g√∂nder
                    await addDoc(collection(db, "requests"), {
                        type: 'market',
                        user: currentUser.id,
                        userName: currentUser.name || currentUser.id,
                        itemId: item.id,
                        itemName: item.name,
                        quantity: qty,
                        price: -totalCost, // Eksi bakiye olarak d√º≈ü√ºlecek
                        currency: item.currency,
                        date: new Date().toISOString(),
                        status: 'pending'
                    });

                    window.showAlert("ƒ∞stek G√∂nderildi", "√ñƒüretmen onayladƒ±ƒüƒ±nda √ºr√ºn senin olacak.", "‚úÖ");
                };
            });
        });
    }

    // --- TAB GE√áƒ∞≈ûLERƒ∞ ---
    const pages = ['home', 'ilim', 'market', 'games'];
    pages.forEach(p => {
        document.getElementById(`nav-${p}`).onclick = () => {
            pages.forEach(x => {
                document.getElementById(`nav-${x}`).classList.remove('active');
                if (x === 'home') document.getElementById('dashboard').style.display = 'none';
                else document.getElementById(`${x}-screen`).style.display = 'none';
            });
            document.getElementById(`nav-${p}`).classList.add('active');
            
            if (p === 'home') document.getElementById('dashboard').style.display = 'block';
            else if (p === 'market') { document.getElementById('market-screen').style.display = 'block'; renderMarket(); }
            else document.getElementById(`${p}-screen`).style.display = 'block';
        };
    });

    // --- ADMIN ƒ∞≈ûLEMLERƒ∞ (G√ñREV KAYDETME D√úZELTMESƒ∞) ---
    function loadAdminData() {
        // Tab y√∂netimi
        const tPages = ['home', 'students', 'market', 'requests'];
        tPages.forEach(p => {
            document.getElementById(`tea-nav-${p}`).onclick = () => {
                tPages.forEach(x => {
                    document.getElementById(`tea-nav-${x}`).classList.remove('active');
                    document.getElementById(`tea-page-${x}`).classList.remove('active');
                });
                document.getElementById(`tea-nav-${p}`).classList.add('active');
                document.getElementById(`tea-page-${p}`).classList.add('active');
                if(p === 'requests') loadRequests();
            }
        });

        // G√∂rev G√ºncelleme Butonu
        document.getElementById('update-task-btn').onclick = async () => {
            const taskText = document.getElementById('admin-task').value;
            const taskPoints = document.getElementById('admin-points').value;
            
            // --- TARƒ∞HLERƒ∞ AL ---
            const startDate = document.getElementById('admin-task-start').value;
            const endDate = document.getElementById('admin-task-end').value;
            // -------------------

            if (taskText && taskPoints) {
                await setDoc(doc(db, "global", "task"), {
                    text: taskText,
                    reward: parseInt(taskPoints),
                    startDate: startDate, // Kaydet
                    endDate: endDate,     // Kaydet
                    id: Date.now().toString()
                });
                window.showAlert("Tamam", "G√∂rev ve tarihler g√ºncellendi.", "üì¢");
            } else {
                window.showAlert("Eksik", "L√ºtfen g√∂rev ve puan girin.", "‚ö†Ô∏è");
            }
        };

        // ƒ∞stekleri Listeleme
        window.loadRequests = () => {
            const rList = document.getElementById('requests-list');
            rList.innerHTML = 'Y√ºkleniyor...';
            const q = query(collection(db, "requests"), where("status", "==", "pending"));
            
            onSnapshot(q, (snap) => {
                rList.innerHTML = '';
                if(snap.empty) { rList.innerHTML = '<div style="padding:20px; text-align:center; color:#999;">Bekleyen istek yok.</div>'; return; }
                
                snap.forEach(rDoc => {
                    const r = { id: rDoc.id, ...rDoc.data() };
                    const div = document.createElement('div');
                    div.style.background = "#fff";
                    div.style.padding = "10px";
                    div.style.marginBottom = "5px";
                    div.style.borderRadius = "10px";
                    div.style.border = "1px solid #eee";
                    div.style.display = "flex";
                    div.style.justifyContent = "space-between";
                    div.style.alignItems = "center";
                    
                    let desc = "";
                    if (r.type === 'market') desc = `üõí <b>${r.userName}</b>, ${r.quantity} adet <b>${r.itemName}</b> istiyor. (${Math.abs(r.price)} ${r.currency})`;
                    else if (r.type === 'task') desc = `üö© <b>${r.userName}</b> g√∂revi tamamladƒ±: "${r.taskText}"`;

                    div.innerHTML = `
                        <div style="font-size:0.85rem;">${desc}</div>
                        <div style="display:flex; gap:5px;">
                            <button id="ok-${r.id}" style="background:#10B981; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;"><i class="fas fa-check"></i></button>
                            <button id="no-${r.id}" style="background:#EF4444; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;"><i class="fas fa-times"></i></button>
                        </div>
                    `;
                    rList.appendChild(div);

                    // Onaylama Mantƒ±ƒüƒ±
                    document.getElementById(`ok-${r.id}`).onclick = async () => {
                        // ƒ∞steƒüi onaylandƒ± yap
                        await updateDoc(doc(db, "requests", r.id), { status: 'approved' });
                        
                        const uRef = doc(db, "users", r.user);
                        const uSnap = await getDoc(uRef);
                        if(uSnap.exists()) {
                            const uData = uSnap.data();
                            
                            if (r.type === 'task') {
                                // Puan ver ve completedTasks'e ekle
                                await updateDoc(uRef, {
                                    points: (uData.points || 0) + parseInt(r.reward),
                                    completedTasks: arrayUnion(r.itemId),
                                    pendingTasks: (uData.pendingTasks || []).filter(x => x !== r.itemId)
                                });
                            } else if (r.type === 'market') {
                                // Puan d√º≈ü (price zaten eksi geliyor)
                                const cost = Math.abs(r.price);
                                if (r.currency === 'np') {
                                    await updateDoc(uRef, { namazPoints: (uData.namazPoints || 0) - cost });
                                } else {
                                    await updateDoc(uRef, { points: (uData.points || 0) - cost });
                                }
                                // Stoƒüu d√º≈ü (basit√ße burada yapƒ±labilir veya cloud function)
                                // Envantere ekle mantƒ±ƒüƒ± eklenebilir
                            }
                        }
                    };

                    // Reddetme Mantƒ±ƒüƒ±
                    document.getElementById(`no-${r.id}`).onclick = async () => {
                        await updateDoc(doc(db, "requests", r.id), { status: 'rejected' });
                        // Bekleyen listesinden √ßƒ±kar
                         const uRef = doc(db, "users", r.user);
                         const uSnap = await getDoc(uRef);
                         if(uSnap.exists()) {
                             const uData = uSnap.data();
                             if(r.type === 'task') {
                                 const newPending = (uData.pendingTasks || []).filter(x => x !== r.itemId);
                                 await updateDoc(uRef, { pendingTasks: newPending });
                             }
                         }
                    };
                });
            });
        };
    }

    // --- OYUN MANTIKLARI (Basitle≈ütirilmi≈ü) ---
    window.SpaceRunner = {
        startGame: () => {
            // Kamera ve Canvas ba≈ülatma kodlarƒ± buraya gelir
            // (Mevcut kodunuzda olduƒüu gibi kalabilir, buraya placeholder koyuyorum)
            window.showAlert("Oyun", "Oyun ba≈ülatƒ±lƒ±yor...", "üöÄ");
            // initGame(); // Orijinal fonksiyona √ßaƒürƒ±
        },
        closeGame: () => {
            document.getElementById('game-wrapper').style.display = 'none';
        }
    };

    window.ArabicLeague = {
        open: () => { document.getElementById('arabic-game-wrapper').style.display = 'flex'; },
        close: () => { document.getElementById('arabic-game-wrapper').style.display = 'none'; },
        startGame: () => { 
            document.getElementById('arabic-menu-screen').style.display = 'none';
            document.getElementById('arabic-play-screen').style.display = 'flex';
        },
        goMenu: () => {
            document.getElementById('arabic-play-screen').style.display = 'none';
            document.getElementById('arabic-menu-screen').style.display = 'flex';
        }
    };

// --- UZAY MACERASI OYUN MOTORU ---
    // (MediaPipe Hands k√ºt√ºphanesi ile el takibi yapar)
    const videoElement = document.getElementById('videoElement');
    const canvasElement = document.getElementById('gameCanvas');
    const canvasCtx = canvasElement.getContext('2d');
    
    let gameActive = false;
    let spaceshipY = 200;
    let obstacles = [];
    let gameSpeed = 5;
    let score = 0;
    let handResults = null;
    let camera = null;

    window.SpaceRunner = {
        startGame: async () => {
            document.getElementById('game-overlay').style.display = 'none';
            document.getElementById('videoElement').style.display = 'block';
            gameActive = true;
            score = 0;
            obstacles = [];
            spaceshipY = canvasElement.height / 2;
            
            // Kamera ba≈ülat
            if(!camera) {
                const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
                hands.setOptions({maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5});
                hands.onResults(onResults);
                
                camera = new Camera(videoElement, {
                    onFrame: async () => { await hands.send({image: videoElement}); },
                    width: 320, height: 240
                });
                await camera.start();
            }
            
            resizeCanvas();
            requestAnimationFrame(gameLoop);
        },
        closeGame: () => {
            gameActive = false;
            document.getElementById('game-wrapper').style.display = 'none';
            document.getElementById('videoElement').style.display = 'none';
            if(camera) { /* Kamera durdurulabilir ama yeniden ba≈ülatmak i√ßin a√ßƒ±k bƒ±rakƒ±yoruz */ }
        }
    };

    function onResults(results) {
        handResults = results;
        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
            const y = results.multiHandLandmarks[0][9].y; // Orta parmak k√∂k√º
            spaceshipY = y * canvasElement.height;
        }
    }

    function resizeCanvas() {
        canvasElement.width = window.innerWidth;
        canvasElement.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);

    function gameLoop() {
        if (!gameActive) return;
        
        // Temizle
        canvasCtx.fillStyle = 'black';
        canvasCtx.fillRect(0, 0, canvasElement.width, canvasElement.height);
        
        // Yƒ±ldƒ±zlar (Basit efekt)
        canvasCtx.fillStyle = 'white';
        for(let i=0; i<20; i++) canvasCtx.fillRect(Math.random()*canvasElement.width, Math.random()*canvasElement.height, 2, 2);

        // Uzay Gemisi √áiz
        canvasCtx.fillStyle = '#00ff00';
        canvasCtx.beginPath();
        canvasCtx.moveTo(50, spaceshipY);
        canvasCtx.lineTo(20, spaceshipY - 15);
        canvasCtx.lineTo(20, spaceshipY + 15);
        canvasCtx.fill();

        // Engeller
        if (Math.random() < 0.02) {
            obstacles.push({x: canvasElement.width, y: Math.random() * canvasElement.height, size: 30 + Math.random() * 50});
        }

        for (let i = 0; i < obstacles.length; i++) {
            let obs = obstacles[i];
            obs.x -= gameSpeed;
            
            canvasCtx.fillStyle = 'red';
            canvasCtx.fillRect(obs.x, obs.y, obs.size, obs.size);

            // √áarpƒ±≈üma Kontrol√º
            if (obs.x < 50 && obs.x + obs.size > 20 && Math.abs(obs.y - spaceshipY) < obs.size) {
                gameOver();
                return;
            }
        }
        
        obstacles = obstacles.filter(o => o.x > -100);
        
        // Skor
        score++;
        canvasCtx.fillStyle = 'white';
        canvasCtx.font = '20px "Press Start 2P"';
        canvasCtx.fillText(`SKOR: ${score}`, 20, 50);

        gameSpeed += 0.001; // Hƒ±zlanma
        requestAnimationFrame(gameLoop);
    }

    function gameOver() {
        gameActive = false;
        alert(`OYUN Bƒ∞TTƒ∞! Skorun: ${score}`);
        document.getElementById('game-overlay').style.display = 'flex';
        // Skoru kaydetmek isterseniz buraya updateDoc ekleyebilirsiniz.
    }

    // --- ARAP√áA Lƒ∞Gƒ∞ OYUN MOTORU ---
    const arabicWords = [
        {ar: "ŸÉŸêÿ™Ÿéÿßÿ®", tr: "Kitap"}, {ar: "ŸÇŸéŸÑŸéŸÖ", tr: "Kalem"}, {ar: "ŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©", tr: "Okul"},
        {ar: "ÿ®Ÿéÿßÿ®", tr: "Kapƒ±"}, {ar: "ŸÜŸéÿßŸÅŸêÿ∞Ÿéÿ©", tr: "Pencere"}, {ar: "ÿ∑ŸéÿßŸÑŸêÿ®", tr: "√ñƒürenci"},
        {ar: "ŸÖŸèÿπŸéŸÑŸëŸêŸÖ", tr: "√ñƒüretmen"}, {ar: "ÿµŸéŸÅŸë", tr: "Sƒ±nƒ±f"}, {ar: "ÿØŸéŸÅŸíÿ™Ÿéÿ±", tr: "Defter"},
        {ar: "ÿ≠ŸéŸÇŸêŸäÿ®Ÿéÿ©", tr: "√áanta"}
    ];
    let arScore = 0;
    let arLives = 3;
    let currentWord = null;

    window.ArabicLeague = {
        open: () => { document.getElementById('arabic-game-wrapper').style.display = 'flex'; },
        close: () => { document.getElementById('arabic-game-wrapper').style.display = 'none'; },
        startGame: () => {
            document.getElementById('arabic-menu-screen').style.display = 'none';
            document.getElementById('arabic-play-screen').style.display = 'flex';
            arScore = 0;
            arLives = 3;
            updateArUI();
            nextArQuestion();
        },
        goMenu: () => {
            document.getElementById('arabic-play-screen').style.display = 'none';
            document.getElementById('arabic-menu-screen').style.display = 'flex';
        },
        playAudio: () => {
            // Web Speech API kullanarak Arap√ßa okuma (Tarayƒ±cƒ± destekliyorsa)
            if('speechSynthesis' in window && currentWord) {
                const utterance = new SpeechSynthesisUtterance(currentWord.ar);
                utterance.lang = 'ar-SA';
                window.speechSynthesis.speak(utterance);
            } else {
                window.showAlert("Ses", "Tarayƒ±cƒ±nƒ±z ses √∂zelliƒüini desteklemiyor.", "üîä");
            }
        }
    };

    function updateArUI() {
        document.getElementById('ar-scoreDisplay').innerText = arScore;
        document.getElementById('ar-livesDisplay').innerText = arLives;
    }

    function nextArQuestion() {
        if(arLives <= 0) {
            alert(`Oyun Bitti! Puanƒ±n: ${arScore}`);
            window.ArabicLeague.goMenu();
            return;
        }
        
        // Rastgele kelime se√ß
        const qIndex = Math.floor(Math.random() * arabicWords.length);
        currentWord = arabicWords[qIndex];
        
        document.getElementById('ar-questionText').innerText = currentWord.ar;
        
        // ≈ûƒ±klarƒ± olu≈ütur (1 doƒüru, 3 yanlƒ±≈ü)
        let options = [currentWord.tr];
        while(options.length < 4) {
            const r = arabicWords[Math.floor(Math.random() * arabicWords.length)].tr;
            if(!options.includes(r)) options.push(r);
        }
        options.sort(() => Math.random() - 0.5); // Karƒ±≈ütƒ±r
        
        const grid = document.getElementById('ar-optionsGrid');
        grid.innerHTML = '';
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkArAnswer(opt, btn);
            grid.appendChild(btn);
        });
    }

    function checkArAnswer(selected, btn) {
        if(selected === currentWord.tr) {
            btn.classList.add('correct');
            arScore += 10;
            setTimeout(nextArQuestion, 500);
        } else {
            btn.classList.add('wrong');
            arLives--;
            if(arLives > 0) window.showAlert("Yanlƒ±≈ü", "Dikkat et!", "‚ùå");
            setTimeout(nextArQuestion, 500);
        }
        updateArUI();
    }
</script>
</body>
</html>
</body>
</html>
